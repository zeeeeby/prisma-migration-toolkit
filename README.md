# DB Migrations

Эта директория включает в себя схему базы данных, скрипты для запуска базы данных и управления миграциями. </br>
Используется исключительно для создания миграций в `development` окружении </br>
При деплое на тестинг или прод, в CI запускается скрипт flyway, который берёт миграции из папки `./prisma/flyway_readonly_migrations` </br>
Важно, что директория `flyway_readonly_migrations` заполняется скриптом при создании миграций. Не нужно вручную менять в ней файлы

## Предварительные настройки
Для создания миграций используется инструмент [Prisma](https://www.prisma.io/docs/getting-started), который работает на nodejs </br>
1. Для начала работы нужно установить [nodejs](https://nodejs.org/en)
2. В папке `superback/migrations` установить зависимости командой `yarn`


## Описание процесса работы с миграциями
### Изменение схемы в `schema.prisma`
1. Поднять бд командой `yarn dev`.
2. Сделать необходимые изменения в `schema.prisma` файле.
3. Запустить `yarn db-push` чтобы синхронизировать схему с бд.
4. Запустить `yarn migrate название_миграции` чтобы создать миграцию.

### Изменение схемы прямо в бд (напр. через DataGrip)
1. Поднять бд командой `yarn dev`.
2. Сделать необходимые изменения в бд.
3. Запустить `yarn migrate название_миграции` чтобы создать миграцию.

### Изменение схемы в коде
1. Поднять бд командой `yarn dev`.
2. Сделать необходимые изменения в коде.
3. Накатить изменения в бд, в нашем случае при старте сервер сам создает таблицы/колонки, поэтому достаточно скомпилировать и запустить его.
4. Запустить `yarn migrate название_миграции` чтобы создать миграцию.


